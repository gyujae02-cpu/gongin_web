<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>공인 길드 관리 시스템 - 길드원 관리</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" as="style" crossorigin
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
  <link rel="stylesheet" href="./assets/css/members.css" />
</head>

<body>
  <div class="wrap">
    <!-- ✅ Auth Guard (로그인 여부만 검사 / admin 고정 검사 제거) -->
    <script>
      (function () {
        const AUTH_KEY = "guild_auth_v1";
        try {
          const raw = localStorage.getItem(AUTH_KEY);
          const a = raw ? JSON.parse(raw) : null;
          if (!a || !a.exp || Date.now() > a.exp) {
            localStorage.removeItem(AUTH_KEY);
            location.replace("index.html");
          }
        } catch (e) {
          localStorage.removeItem(AUTH_KEY);
          location.replace("index.html");
        }
      })();
    </script>

    <!-- ===== Top Navbar (one-line) ===== -->
    <header class="topnav" role="banner" aria-label="Top Navigation">
      <div class="topnav-inner">
        <div class="topnav-left">
          <span class="brand-title">공인 길드 관리 시스템</span>

          <!-- ✅ ADD: version + patchnote button -->
          <div class="brand-tools" aria-label="Version and Patch Notes">
            <span id="appVer" class="chip-mini p-100 brand-ver">v1.1</span>
            <button id="patchBtn" type="button" class="topnav-chipbtn" data-bs-toggle="modal"
              data-bs-target="#patchModal">
              패치노트
            </button>
          </div>
        </div>

        <nav class="topnav-links" aria-label="Primary">
          <a class="topnav-link active" href="members.html">길드원 관리</a>
          <a class="topnav-link" href="notice.html">길드 공지</a>
        </nav>
      </div>
    </header>

    <div class="layout">
      <!-- ===== Nav (Desktop: left, Mobile/Tablet: collapsible) ===== -->
      <aside class="navx" aria-label="Navigation">
        <details class="navx-collapse" open>
          <summary class="navx-summary">
            <span class="navx-summary-left">
              <span class="navx-dot"></span>
              <span class="navx-summary-title">도구</span>
            </span>
            <span class="navx-summary-right">
              <span class="navx-kbd">Menu</span>
              <span class="navx-chevron">▾</span>
            </span>
          </summary>

          <div class="navx-card">
            <div class="navx-group">
              <div class="navx-label">보기</div>
              <button id="modeBtn" class="navx-btn" type="button">
                <span class="navx-ico">▦</span>
                <span class="navx-txt">모드: 테이블</span>
              </button>
            </div>

            <div class="navx-group">
              <div class="navx-label">관리</div>
              <button id="addBtn" class="navx-btn" type="button" disabled>
                <span class="navx-ico">＋</span>
                <span class="navx-txt">길드원 추가</span>
              </button>
            </div>

            <div class="navx-divider"></div>

            <button id="logoutBtn" class="navx-btn danger" type="button">
              <span class="navx-ico">⎋</span>
              <span class="navx-txt">로그아웃</span>
            </button>

            <!-- <div class="navx-foot">
              <span class="chip-mini p-100">v1.0</span>
            </div> -->
          </div>
        </details>
      </aside>

      <!-- ===== Main ===== -->
      <main class="mainx">
        <section class="cardx mb-3">
          <div class="topbar">
            <div class="top-row">
              <div class="min-w-0">
                <div class="title">공인 길드원 관리</div>
                <div class="desc" id="pageDesc">
                  불러오는 중…
                </div>
              </div>
            </div>

            <div id="loadingBox" class="loading">불러오는 중…</div>
            <div id="errorBox" class="error"></div>
          </div>

          <div class="controls">
            <div class="controls-grid">
              <div class="seg" id="seg">
                <button type="button" class="active" data-tier="ALL">ALL</button>
                <button type="button" data-tier="1">공인1</button>
                <button type="button" data-tier="2">공인2</button>
                <button type="button" data-tier="3">공인3</button>
                <button type="button" data-tier="4">공인4</button>
                <button type="button" data-tier="5">공인5</button>
                <button type="button" data-tier="JOIN" class="join-btn">가입 대기</button>
                <button type="button" data-tier="BLACK" class="btn-black">블랙 리스트</button>
              </div>

              <div class="searchbox">
                <input id="q" class="control w-100" placeholder="닉네임 / 직위 / 비고 검색" />
              </div>
            </div>

            <div id="sortbar" class="sortbar">
              <div class="sortpill" id="sortDirPill" role="button" tabindex="0">정렬: 내림차순</div>
              <select id="sortKeySel" aria-label="정렬 기준">
                <option value="power">전투력</option>
                <option value="nick">닉네임</option>
                <option value="role">직위</option>
                <option value="note">비고</option>
              </select>
              <div class="hint">테이블 헤더 클릭 정렬 지원</div>
            </div>
          </div>

          <div class="stats-row">
            <div class="stat">표시 <span class="value" id="statCount">0명</span></div>
            <div class="stat">합계 <span class="value" id="statSum">0억</span></div>
            <div class="stat">평균 <span class="value" id="statAvg">0억</span></div>
            <div class="stat">최대 <span class="value" id="statMax">0억</span></div>
            <div class="stat">최소 <span class="value" id="statMin">0억</span></div>
          </div>
        </section>

        <section class="cardx" id="viewRoot">
          <div class="table-wrap" aria-label="Members Table">
            <table class="tablex">
              <thead id="thead">
                <tr>
                  <th class="num-col" data-key="rowno">No <span class="sort-ind" data-si="rowno"></span></th>
                  <th class="nick-col" data-key="nick">닉네임 <span class="sort-ind" data-si="nick"></span></th>
                  <th class="role-col" data-key="role">직위 <span class="sort-ind" data-si="role"></span></th>
                  <th class="power-col right" data-key="power">전투력 <span class="sort-ind" data-si="power"></span></th>
                  <th class="note-col" data-key="note">비고 <span class="sort-ind" data-si="note"></span></th>
                  <th class="act-col" data-key="act">작업</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <!-- cards (mobile) -->
          <div class="list-wrap" id="listWrap">
            <div id="cards"></div>
          </div>
        </section>
      </main>
    </div>

    <!-- ===== Footer ===== -->
    <footer class="footerx" role="contentinfo">
      <div class="footerx-inner">
        <div class="footerx-left">
          <div>© 2025 메이플키우기 공인 길드</div>
          <div class="footerx-nexon">Background image © NEXON Korea Corporation. All Rights Reserved.</div>
        </div>
        <div class="footerx-right">
          <a class="footerx-mail" href="mailto:gonginofficial@gmail.com">gonginofficial@gmail.com</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal fade" id="memberModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modalx">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">길드원 추가</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">공인</label>
              <select id="mTier" class="form-select control">
                <option value="1">공인1</option>
                <option value="2">공인2</option>
                <option value="3">공인3</option>
                <option value="4">공인4</option>
                <option value="5">공인5</option>
              </select>
            </div>

            <div class="col-12">
              <label class="form-label">닉네임</label>
              <input id="mNick" class="control w-100" placeholder="닉네임" maxlength="40" />
            </div>

            <div class="col-12">
              <label class="form-label">직위</label>
              <input id="mRole" class="control w-100" placeholder="예: 마스터 / 다운증후군 / 길드원" maxlength="40" />
            </div>

            <div class="col-12">
              <label class="form-label">전투력</label>
              <input id="mPower" class="control w-100" type="number" step="0.1" min="0" placeholder="예: 123.4" />
            </div>

            <div class="col-12">
              <label class="form-label">비고</label>
              <textarea id="mNote" class="control w-100" rows="3" placeholder="비고" maxlength="400"></textarea>
            </div>

            <div id="modalErr" class="modal-err"></div>
          </div>
        </div>

        <div class="modal-footer d-flex gap-2">
          <button id="deleteBtn" type="button" class="btn btn-outline-danger me-auto d-none">삭제</button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
          <button id="saveBtn" type="button" class="btn btn-primary">적용</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ ADD: Patch Notes Modal -->
  <div class="modal fade" id="patchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content modalx patch-modal">
        <div class="modal-header">
          <div class="d-flex align-items-center gap-2">
            <h5 class="modal-title m-0">패치노트</h5>
            <span class="chip-mini p-100" id="patchLatestVer">v1.0</span>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
        </div>

        <div class="modal-body">
          <!-- JS가 채움: patches 렌더링 -->
          <div id="patchList" class="patch-list"></div>

          <!-- JS가 채움: 5개 초과 시 페이지 버튼 표시 -->
          <div class="patch-pager">
            <button id="patchPrev" class="patch-pagebtn" type="button" disabled>이전</button>
            <div id="patchPageInfo" class="patch-pageinfo">1 / 1</div>
            <button id="patchNext" class="patch-pagebtn" type="button" disabled>다음</button>
          </div>

          <div id="patchEmpty" class="empty-box" style="display:none;">
            표시할 패치내역이 없습니다.
          </div>
        </div>

        <div class="modal-footer d-flex gap-2">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./assets/js/members.js"></script>
  <script src="./assets/js/patchnotes.js"></script>

  <script>
    (function () {
      'use strict';
      document.addEventListener('keydown', function (e) {
        const key = (e.key || "").toLowerCase();
        if (e.key === 'F12') { e.preventDefault(); e.stopPropagation(); return false; }
        if (e.ctrlKey) {
          if (['s', 'u', 'p', 'a', 'c'].includes(key)) { e.preventDefault(); e.stopPropagation(); return false; }
          if (e.shiftKey && ['i', 'j', 'c'].includes(key)) { e.preventDefault(); e.stopPropagation(); return false; }
        }
      }, true);
    })();
  </script>
</body>

</html>